#!/opt/nailgun/bin/python
__requires__ = 'Nailgun==0.1.0'
import sys


if __name__ == '__main__':
    from nailgun.db import engine
    from nailgun.keepalive import keep_alive
    from nailgun.logger import logger
    from nailgun.settings import settings

    logger.info("Fuel-Web KeepAlive {0} SHA: {1}\nFuel SHA: {2}".format(
                settings.PRODUCT_VERSION,
                settings.COMMIT_SHA,
                settings.FUEL_COMMIT_SHA
                ))
    if not engine.dialect.has_table(engine.connect(), "nodes"):
        logger.error(
            "Database tables not created. Try './manage.py syncdb' first")
        sys.exit(1)

    keep_alive.run()

    logger.info("Stopping KeepAlive...")
    if keep_alive.is_alive():
        logger.info("Stopping KeepAlive watcher...")
