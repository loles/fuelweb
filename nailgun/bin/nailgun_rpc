#!/opt/nailgun/bin/python
__requires__ = 'Nailgun==0.1.0'
import sys


if __name__ == '__main__':
    from nailgun.db import engine
    from nailgun.logger import logger
    from nailgun.rpc import threaded
    from nailgun.settings import settings

    logger.info("Fuel-Web RPC {0} SHA: {1}\nFuel SHA: {2}".format(
                settings.PRODUCT_VERSION,
                settings.COMMIT_SHA,
                settings.FUEL_COMMIT_SHA
                ))
    if not engine.dialect.has_table(engine.connect(), "nodes"):
        logger.error(
            "Database tables not created. Try './manage.py syncdb' first")
        sys.exit(1)

    rpc_process = threaded.RPCKombuThread()
    logger.info("Running RPC consumer...")
    rpc_process.run()

    logger.info("Stopping RPC...")
    if rpc_process.is_alive():
        logger.info("Stopping RPC watcher...")
